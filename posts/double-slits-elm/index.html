<!doctype html><html lang=en><head><title>Double-Slit Diffraction in Elm</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A demo of the double-slits experiment (Young's slits) written in Elm."><link href="/css/main.min.cbea4dffd5bf7bf2c87de9504c4cac811c1f22ad854c538f0e08bbad25d60973.css" rel=stylesheet><link rel=icon type=image/svg+xml href=/images/logo.svg><link rel=stylesheet href=https://rsms.me/inter/inter.css><script src=/js/prism.js></script></head><body class="bg-stone-50 text-stone-600 dark:bg-stone-900 dark:text-stone-400"><nav class="mb-1 shadow dark:shadow-none dark:border-b dark:border-stone-300/10"><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"><div class="relative flex justify-between h-20"><div class="absolute inset-y-0 left-0 flex items-center sm:hidden"><button id=menu-button type=button class="inline-flex items-center justify-center p-2 rounded-md text-stone-400 hover:text-stone-500 hover:bg-stone-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-600" aria-controls=mobile-menu aria-expanded=false>
<span class=sr-only>Open main menu</span><svg id="open-menu-icon" class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg><svg id="close-menu-icon" class="hidden h-6 w-6" xmlns="htp://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start"><div class="flex-shrink-0 flex items-center"><a href=/><svg class="block lg:hidden h-14 w-auto dark:fill-stone-300 dark:stroke-stone-400" viewBox="0 0 1250 1250"><desc>Broch logo</desc><path d="M50 550A5e2 5e2.0 01550 50h145a5e2 5e2.0 015e2 5e2v1e2a5e2 5e2.0 01-5e2 5e2v-130a370 370 0 00370-370m0-1e2A370 370 0 00695 180H550A370 370 0 00180 550m0 1e2a370 370 0 00370 370v130A5e2 5e2.0 0150 650V550" stroke-width="55" fill="none"/></svg><svg class="hidden lg:block h-14 w-auto dark:fill-stone-300 dark:stroke-stone-400" stroke="#292524" fill="#292524" viewBox="0 0 3500 1250"><desc>Broch logo</desc><g><path d="M50 550A5e2 5e2.0 01550 50h145a5e2 5e2.0 015e2 5e2v1e2a5e2 5e2.0 01-5e2 5e2v-130a370 370 0 00370-370m0-1e2A370 370 0 00695 180H550A370 370 0 00180 550m0 1e2a370 370 0 00370 370v130A5e2 5e2.0 0150 650V550" stroke-width="55" fill="none"/></g><g transform="translate(1600 1050) scale(.18 -.18)"><path d="m525 3939c-137-15-256-28-263-28-10-1-12-289-10-1423l3-1423 267-3 267-2 5 32c3 18 10 60 16 92 5 33 10 62 10 64 0 3 33-26 73-64 85-82 137-114 243-151 71-24 93-27 214-27 98-1 153 4 2e2 17 258 69 463 295 555 613 40 137 55 260 55 456 0 417-89 7e2-279 888-128 127-269 181-471 182-201 0-342-54-472-183l-78-76v533 534l-42-1c-24-1-155-14-293-30zm811-1247c56-29 119-103 144-169 34-92 51-230 51-427 0-99-5-213-11-251-31-198-95-316-204-373-44-22-63-26-136-26-122 0-203 40-281 137l-39 50v427 428l43 59c63 84 130 136 217 164 46 15 171 4 216-19z"/><path d="m8303 3942-253-25V2493 1070h3e2 3e2v698 697l51 67c96 128 197 192 303 192 70-1 115-20 144-61 47-69 46-54 50-845l3-748h299 3e2v803c0 891 0 881-66 1016-108 219-359 323-642 265-141-29-251-87-366-195l-76-71v541 541l-47-1c-27-1-162-13-3e2-27z"/><path d="m4655 3155c-268-42-482-178-629-399-234-353-231-1006 7-1356 123-181 310-311 521-360 182-44 421-44 591 0 1e2 25 241 93 322 154 302 228 436 668 356 1166-60 379-286 657-618 759-155 48-380 63-550 36zm306-445c82-23 161-105 2e2-209 65-175 77-537 23-744-35-138-99-228-192-274-50-24-68-28-147-28-105 0-163 23-226 88-99 102-148 320-136 612 7 171 27 277 72 372 78 167 225 234 406 183z"/><path d="m6898 3155c-402-68-686-357-779-795-29-136-32-406-6-547 87-473 408-765 884-803 134-10 285 3 399 35 156 44 393 176 380 211-4 10-223 326-250 361-1 1-51-22-111-52-79-39-135-59-198-71-81-16-93-16-169-1-236 46-330 240-315 642 9 231 49 363 140 462 136 147 391 144 613-7l40-28 128 175c72 1e2 125 182 122 190-9 23-187 132-269 164-195 75-410 97-609 64z"/><path d="m3498 3137c-153-53-279-181-354-364-13-32-24-53-24-48-1 6-11 91-23 190l-22 180-267 3-268 2V2085 1070h305 304l3 533 3 532 33 95c98 283 233 378 480 337 60-10 85-11 88-3 7 20 94 569 91 573-10 10-121 23-196 23-63 0-104-7-153-23z"/></g></svg></a></div><div class="hidden sm:ml-9 sm:flex sm:space-x-8"><a class="border-transparent text-stone-400 hover:border-stone-300 hover:text-stone-700 dark:hover:text-stone-400 inline-flex items-center px-1 pt-1 border-b-2 text-lg font-medium" href=/ title>Home</a>
<a class="border-red-600 dark:border-red-500 text-stone-900 dark:text-stone-300 inline-flex items-center px-1 pt-1 border-b-2 text-lg font-medium" href=/posts/ title=Blog>Blog</a></div></div><div class="absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0"><a href=/index.xml class="p-1 rounded-full text-stone-400 hover:text-stone-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><span class=sr-only>RSS Feed</span><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18.0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"/></svg></a></dev></div></div><div class=hidden id=mobile-menu><div class="pt-2 pb-4 space-y-1"><a class="border-transparent text-stone-500 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-400 hover:border-stone-300 hover:text-stone-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium" href=/ title>Home</a>
<a class="bg-red-50 dark:bg-red-800 border-red-600 text-red-900 dark:text-red-300 block pl-3 pr-4 py-2 border-l-4 text-base font-medium" href=/posts/ title=Blog>Blog</a></div></div></nav><script>var menu_open=!1,menu_button=document.getElementById("menu-button"),menu=document.getElementById("mobile-menu"),open_icon=document.getElementById("open-menu-icon"),close_icon=document.getElementById("close-menu-icon");menu_button.addEventListener("click",function(){menu_open=!menu_open,menu_open?(menu.className="block sm:hidden",close_icon.className.baseVal="block h-6 w-6",open_icon.className.baseVal="hidden h-6 w-6"):(menu.className="hidden",open_icon.className.baseVal="block h-6 w-6",close_icon.className.baseVal="hidden h-6 w-6")})</script><div class="w-full max-w-7xl mx-auto"><main><article class="py-12 px-4 sm:px-8 lg:px-8 prose prose-stone prose-lg max-w-none lg:prose-xl dark:prose-invert"><h1>Double-Slit Diffraction in Elm</h1><p class="block flex display-between text-stone-500 dark:text-stone-400 italic">January 2, 2017</p><p>I&rsquo;ve been meaning to try <a href=http://elm-lang.org>Elm</a> for some time and finally made the effort to write some code. It&rsquo;s a demo of the <a href=https://en.wikipedia.org/wiki/Double-slit_experiment>double-slits experiment</a>. I already had some Java code which I wrote ages ago, but I&rsquo;ve never got round to converting it to Javascript <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. Elm seems like a nice alternative so I decided to give it a try.</p><div style="margin:0 auto;width:750px;height:500px"><div id=slits></div></div><div id=controls class=mt-2><label for=numSlits>Number of slits</label>
<select class=text-neutral-500 id=numSlits onchange=changeSlits()><option value=1>1</option><option value=2 selected>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option></select></div><script src=slits.js></script><script>var app=Elm.Main.init({node:document.getElementById("slits"),flags:{width:750,height:500}}),nSlitsNode=document.getElementById("numSlits");nSlitsNode.options[1].selected=!0;function changeSlits(){app.ports.numberOfSlits.send(Number(nSlitsNode.value))}</script><p>The app shows the light source, slits and the screen with an intensity graph of the diffraction pattern. An enlarged representation of the slits is shown on the left. Slits can be dragged about or resized and the diffraction pattern updates accordingly. You can also change the number of slits, making this a rather poorly named article, but the double-slit case is the most famous.</p><p>The code is <a href=https://github.com/tekul/elm-slits>on github</a>. Most of it is pretty easy to follow if you&rsquo;ve read the standard <a href=https://guide.elm-lang.org/>introduction to elm</a>. It also includes some use of SVG and drag and drop and the use of ports to interact with the outside.</p><h2 id=overview>Overview</h2><p>The most important part of the model is the <a href=https://github.com/tekul/elm-slits/blob/4232544c5f5c74734ada4d81667b788c33044c7f/src/Model.elm#L27>list of slits</a> which provides the zoomed-in view of the slit array. A slit is represented by the y coordinates of its edges. Changes to the slits cause updates both in their representation in the UI and in the diffraction pattern which is rendered. The model also contains a representation of the current drag state. This is similar to the standard <a href=http://elm-lang.org/examples/drag>elm drag and drop example</a> but with a few changes to deal with the differences between the page and SVG coordinate systems. It contains the starting y-coordinate, the slit being dragged and also a <code>DragType</code> value. This captures the fact that a slit can be either moved or resized by dragging it, depending on whether you click nearer the middle or the edge. The coordinates of the slit array and the screen onto which the diffraction pattern is projected are also stored but are just fixed values.</p><pre><code class=language-elm>type Slit = Slit Int Int

type Drag = Drag DragType Int Slit

type alias Model =
    { slits : List Slit
    , slitsXY : (Int, Int)
    , screen : Screen
    , drag : Maybe Drag
    }

type DragType
    = WholeSlit
    | Bottom
    | Top

type Msg
    = DragStart Int Int
    | DragAt    Int
    | DragEnd
    | NumSlits Int
</code></pre><h3 id=dealing-with-coordinates>Dealing with Coordinates</h3><p>Since the slits are dragged vertically, we only need to worry about the y-coordinate of mouse events. However, we need the coordinate relative to the SVG element whereas Elm&rsquo;s mouse events are relative to the origin of the page <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. This is fine if the application is in the top-left of the page, but if it is embedded in another page (as above), the coordinate systems no longer coincide and we need to translate between them. To do this, I created a transparent overlay rectangle which sits over the slits display, and attached a <a href=https://github.com/tekul/elm-slits/blob/da067c50569cb45409e23ab1df5714ba38896fc1/src/View.elm#L62>separate <code>mousedown</code> handler</a> which creates a <code>DragStart</code> message containing both the <code>pageY</code> and <a href=https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/offsetY><code>offsetY</code></a> values. Since the overlay rectangle covers the full height of the slits, <code>pageY - offsetY</code> gives the y-origin of the SVG element in page coordinates and that allows us to translate future mouse move events from Elm to our SVG frame of reference.</p><h3 id=interaction-with-javascript>Interaction with Javascript</h3><p>If you look at the source for this page, you&rsquo;ll see that the select control for setting the number of slits isn&rsquo;t actually part of the Elm application (though it could easily be). I decided to experiment with using a <a href=https://guide.elm-lang.org/interop/javascript.html>port</a> to update the value, like so:</p><pre><code class=language-elm>port numberOfSlits : (Int -&gt; msg) -&gt; Sub msg
</code></pre><p>and I <a href=https://github.com/tekul/elm-slits/blob/4232544c5f5c74734ada4d81667b788c33044c7f/src/Main.elm#L66>added a subscription</a> to <code>numberOfSlits NumSlits</code>. The app then receives messages of type <code>NumSlits</code> and it can update the model accordingly. If Javascript tries to send in something invalid (not of the expected <code>Int</code> type), then Elm won&rsquo;t let it in and will log an error in the console.
<a href=javascript:void(0) onclick=app.ports.numberOfSlits.send(10)>Clicking here</a>
should change the number of slits to ten.</p><p>Elm &ldquo;Flags&rdquo; are also used to pass the desired width and height of the SVG into the application.</p><h2 id=conclusion>Conclusion</h2><p>This was a brief overview of my first go at playing with Elm. My Javascript knowledge is rather limited, and I haven&rsquo;t tried out any of its competitors so I can&rsquo;t really draw any conclusions on how Elm compares. It certainly compared favourable with my experience of writing even small programs in Javascript. It allows you to write typed programs, with a similar syntax to Haskell and it limits what can happen in your program, making debugging a lot easier. You can step back through all the events you&rsquo;ve received and inspect the resulting changes in the model. Elm puts you in a cosy little world within your application, where you are completely isolated from nasty runtime errors. That worked out fine for a simple application like this one, but how well it scales up into more complicated applications, I don&rsquo;t know yet. The next thing on my Elm to-do list is to build something that actually talks to a server.</p><p>Any questions or suggestions, please <a href=https://github.com/tekul/elm-slits/issues>post them on github</a>.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>When I was a student, my supervisor Sandy Watt wrote physics demo programs including one like this, and my Java code was based on his original version. His programs were written in Basic with embedded ARM code, but these days we can get away with a high-level language like Elm and rendering images with SVG without having to worry about performance.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Elm gives us the value of the <a href=https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/pageY><code>pageY</code></a> property of the mouse event.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article></main></div></body></html>