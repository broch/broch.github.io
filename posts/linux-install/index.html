<!doctype html><html lang=en><head><title>Linux Setup with XMonad</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Making the move from Mac OSX to a customized Linux setup."><link href="/css/main.min.9980b3c8e1db75033cdbf100b36011cee75b8267f11501d195b9485c01a36f16.css" rel=stylesheet><link rel=icon type=image/svg+xml href=/images/logo.svg><link rel=stylesheet href=https://rsms.me/inter/inter.css><script src=/js/prism.js></script></head><body class="bg-stone-50 text-stone-600 dark:bg-stone-900 dark:text-stone-400"><nav class="mb-1 shadow dark:shadow-none dark:border-b dark:border-stone-300/10"><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"><div class="relative flex justify-between h-20"><div class="absolute inset-y-0 left-0 flex items-center sm:hidden"><button id=menu-button type=button class="inline-flex items-center justify-center p-2 rounded-md text-stone-400 hover:text-stone-500 hover:bg-stone-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-600" aria-controls=mobile-menu aria-expanded=false>
<span class=sr-only>Open main menu</span><svg id="open-menu-icon" class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg><svg id="close-menu-icon" class="hidden h-6 w-6" xmlns="htp://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start"><div class="flex-shrink-0 flex items-center"><a href=/><svg class="block lg:hidden h-14 w-auto dark:fill-stone-300 dark:stroke-stone-400" viewBox="0 0 1250 1250"><desc>Broch logo</desc><path d="M50 550A5e2 5e2.0 01550 50h145a5e2 5e2.0 015e2 5e2v1e2a5e2 5e2.0 01-5e2 5e2v-130a370 370 0 00370-370m0-1e2A370 370 0 00695 180H550A370 370 0 00180 550m0 1e2a370 370 0 00370 370v130A5e2 5e2.0 0150 650V550" stroke-width="55" fill="none"/></svg><svg class="hidden lg:block h-14 w-auto dark:fill-stone-300 dark:stroke-stone-400" stroke="#292524" fill="#292524" viewBox="0 0 3500 1250"><desc>Broch logo</desc><g><path d="M50 550A5e2 5e2.0 01550 50h145a5e2 5e2.0 015e2 5e2v1e2a5e2 5e2.0 01-5e2 5e2v-130a370 370 0 00370-370m0-1e2A370 370 0 00695 180H550A370 370 0 00180 550m0 1e2a370 370 0 00370 370v130A5e2 5e2.0 0150 650V550" stroke-width="55" fill="none"/></g><g transform="translate(1600 1050) scale(.18 -.18)"><path d="m525 3939c-137-15-256-28-263-28-10-1-12-289-10-1423l3-1423 267-3 267-2 5 32c3 18 10 60 16 92 5 33 10 62 10 64 0 3 33-26 73-64 85-82 137-114 243-151 71-24 93-27 214-27 98-1 153 4 2e2 17 258 69 463 295 555 613 40 137 55 260 55 456 0 417-89 7e2-279 888-128 127-269 181-471 182-201 0-342-54-472-183l-78-76v533 534l-42-1c-24-1-155-14-293-30zm811-1247c56-29 119-103 144-169 34-92 51-230 51-427 0-99-5-213-11-251-31-198-95-316-204-373-44-22-63-26-136-26-122 0-203 40-281 137l-39 50v427 428l43 59c63 84 130 136 217 164 46 15 171 4 216-19z"/><path d="m8303 3942-253-25V2493 1070h3e2 3e2v698 697l51 67c96 128 197 192 303 192 70-1 115-20 144-61 47-69 46-54 50-845l3-748h299 3e2v803c0 891 0 881-66 1016-108 219-359 323-642 265-141-29-251-87-366-195l-76-71v541 541l-47-1c-27-1-162-13-3e2-27z"/><path d="m4655 3155c-268-42-482-178-629-399-234-353-231-1006 7-1356 123-181 310-311 521-360 182-44 421-44 591 0 1e2 25 241 93 322 154 302 228 436 668 356 1166-60 379-286 657-618 759-155 48-380 63-550 36zm306-445c82-23 161-105 2e2-209 65-175 77-537 23-744-35-138-99-228-192-274-50-24-68-28-147-28-105 0-163 23-226 88-99 102-148 320-136 612 7 171 27 277 72 372 78 167 225 234 406 183z"/><path d="m6898 3155c-402-68-686-357-779-795-29-136-32-406-6-547 87-473 408-765 884-803 134-10 285 3 399 35 156 44 393 176 380 211-4 10-223 326-250 361-1 1-51-22-111-52-79-39-135-59-198-71-81-16-93-16-169-1-236 46-330 240-315 642 9 231 49 363 140 462 136 147 391 144 613-7l40-28 128 175c72 1e2 125 182 122 190-9 23-187 132-269 164-195 75-410 97-609 64z"/><path d="m3498 3137c-153-53-279-181-354-364-13-32-24-53-24-48-1 6-11 91-23 190l-22 180-267 3-268 2V2085 1070h305 304l3 533 3 532 33 95c98 283 233 378 480 337 60-10 85-11 88-3 7 20 94 569 91 573-10 10-121 23-196 23-63 0-104-7-153-23z"/></g></svg></a></div><div class="hidden sm:ml-9 sm:flex sm:space-x-8"><a class="border-transparent text-stone-400 hover:border-stone-300 hover:text-stone-700 dark:hover:text-stone-400 inline-flex items-center px-1 pt-1 border-b-2 text-lg font-medium" href=/ title>Home</a>
<a class="border-red-600 dark:border-red-500 text-stone-900 dark:text-stone-300 inline-flex items-center px-1 pt-1 border-b-2 text-lg font-medium" href=/posts/ title=Blog>Blog</a></div></div><div class="absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0"><a href=/index.xml class="p-1 rounded-full text-stone-400 hover:text-stone-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><span class=sr-only>RSS Feed</span><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18.0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"/></svg></a></dev></div></div><div class=hidden id=mobile-menu><div class="pt-2 pb-4 space-y-1"><a class="border-transparent text-stone-500 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-400 hover:border-stone-300 hover:text-stone-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium" href=/ title>Home</a>
<a class="bg-red-50 dark:bg-red-800 border-red-600 text-red-900 dark:text-red-300 block pl-3 pr-4 py-2 border-l-4 text-base font-medium" href=/posts/ title=Blog>Blog</a></div></div></nav><script>var menu_open=!1,menu_button=document.getElementById("menu-button"),menu=document.getElementById("mobile-menu"),open_icon=document.getElementById("open-menu-icon"),close_icon=document.getElementById("close-menu-icon");menu_button.addEventListener("click",function(){menu_open=!menu_open,menu_open?(menu.className="block sm:hidden",close_icon.className.baseVal="block h-6 w-6",open_icon.className.baseVal="hidden h-6 w-6"):(menu.className="hidden",open_icon.className.baseVal="block h-6 w-6",close_icon.className.baseVal="hidden h-6 w-6")})</script><div class="w-full max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8"><main><article class="mx-auto prose prose-stone prose-lg max-w-none lg:prose-xl dark:prose-invert"><h1>Linux Setup with XMonad</h1><p class="block flex display-between text-stone-500 dark:text-stone-400 italic">November 19, 2016
<span class=ml-3>(Updated, February 11, 2018)</span></p><p>Earlier this year, after many years of using OSX, I decided to switch to using Linux for my desktop. Most of the development tools I use work better on Linux &ndash; I mostly work directly with plain-text format files and I use the terminal a lot. I also wanted to use a tiling window manager with a minimal user interface. The changes Apple have been making to their machines and OS over the past few years have been irrelevant to my needs at best, and in some cases are downright annoying. The recent release of laptops with no escape key and yet more connectors (dongle hell) is just confirmation that I made the right choice. I bought a Thinkpad P50 as my work machine <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><p>I&rsquo;d maintained small Linux server installations for many years, and am happy enough setting up postfix or nginx, but I&rsquo;d never really used Linux as a desktop environment. I wanted to use a lightweight XMonad setup rather than a stock distro desktop installation, which meant having to find out about a lot of things that would otherwise be taken care of automatically, but the result is that I have a simpler system and also a better understanding of how it actually works.</p><p><img src=xmonad-desktop.jpg alt="XMonad up and running"></p><p>This article describes the installation process, things I discovered along the way, and how I got to where I wanted to be (or near enough).</p><h2 id=install-ubuntu-1604-server>Install Ubuntu 16.04 Server</h2><p><em>Update</em>: Not long after writing this article I switched to using Arch Linux as the base distribution, which I&rsquo;d thoroughly recommend. This is my <a href=arch-packages.txt>current list of installed packages</a> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. Also, I now build <code>xmonad</code> and <code>xmobar</code> as part of my local Haskell development environment rather than installing the distro versions, but aside from that, my setup is still very similar to the one described here.</p><p>I used an Ubuntu server installation as a starting point. I wanted something reliable to build on which would be maintained long-term, but I didn&rsquo;t want all the unnecessary noise of a full Gnome/Unity setup when I would be running XMonad as the window manager. I might experiment with other Linux distros in future when I&rsquo;m more familiar with my current setup and have been running it for a while.</p><h2 id=networking>Networking</h2><p>The installation was done with an ethernet connection and if this is missing on a subsequent boot, the system will hang waiting for the connection to come up <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. By default, the static network configuration is read from the file <code>/etc/network/interfaces</code>, but for a laptop, this isn&rsquo;t ideal, as the available networks may change and you probably want to be able to connect to different WIFI networks depending on where you are. The <code>network-manager</code> package is a common solution. First comment out everything but the <code>lo</code> interface in the <code>/etc/network/interfaces</code> file:</p><pre><code class=language-plain># The loopback network interface
auto lo
iface lo inet loopback

# Commented out because we are using network-manager

# The primary network interface
# auto enp0s31f6
# iface enp0s31f6 inet dhcp
</code></pre><p>then install the package without the UI parts:</p><pre><code class=language-shell-session>$ sudo apt install --no-install-recommends network-manager
</code></pre><p>In a normal desktop setup, you would just select an available WIFI network from a menu of available connections. The <code>nmcli</code> command-line tool provides equivalent commands for everything you need to manage connections. NetworkManager will connect automatically to networks in its database when you boot up, so you should only need to interact with it when you are connecting from a new location.</p><p>To create a DHCP configured ethernet connection</p><pre><code class=language-shell-session>$ nmcli connection add conn-name WiredHome type ethernet autoconnect yes
</code></pre><p>To list available WIFI connections (&rsquo;list&rsquo; is optional)</p><pre><code class=language-shell-session>$ nmcli device wifi list
</code></pre><p>To create a new WIFI connection (creates a new connection each time)</p><pre><code class=language-shell-session>$ nmcli device wifi connect &quot;My Favourite Cafe SSID&quot; password thepassword name &quot;Cafe&quot;
</code></pre><p>To switch WIFI off</p><pre><code class=language-shell-session>$ nmcli radio wifi off
</code></pre><p>To list all known connections</p><pre><code class=language-shell-session>$ nmcli connection show
</code></pre><p>To delete connections</p><pre><code class=language-shell-session>$ nmcli connection delete name_or_id
</code></pre><p>You can also edit or delete existing connections. Connections are stored as files in the <code>/etc/NetworkManager/system-connections</code> directory. Note that the passwords are stored in plain text in these files. I don&rsquo;t mind this since none of the WIFI connections I use are very secret <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>.</p><h2 id=managing-external-disks>Managing External Disks</h2><p>The <code>udisks2</code> package seems to be the back-end which most filesystem management tools (e.g. Nautilus) use to deal with hotplugging of USB disks, so I installed this. It comes with a command line program <code>udisksctl</code>.</p><p>To list devices</p><pre><code class=language-shell-session>$ udisksctl status
MODEL             REVISION    SERIAL          DEVICE
-------------------------------------------------
Databar           5.00        07ABC           sda

</code></pre><p>To find out more about a device</p><pre><code class=language-shell-session>$ udisksctl info -b /dev/sda
</code></pre><p>To mount a filesystem</p><pre><code class=language-shell-session>$ udisksctl mount -b /dev/sda1
</code></pre><p>To unmount it</p><pre><code class=language-shell-session>$ udisksctl unmount -b /dev/sda1
</code></pre><p>To power off the disks</p><pre><code class=language-shell-session>$ udisksctl power-off -b /dev/sda
</code></pre><p>Disks are mounted under <code>/media/&lt;username>/</code>.</p><h2 id=key-ring---storing-passwords-securely>Key Ring - Storing Passwords Securely</h2><p>We don&rsquo;t want lots of email passwords and other secrets lying about in configuration files. A keyring program stores passwords (or other sensitive data) in an encrypted database, encrypted with a master password. The most common seems to be <code>gnome-keyring</code> which uses the derives a key from the login password to encrypt the data. Fortunately it can be used without pulling in anything else Gnome-related:</p><pre><code class=language-shell-session>$ sudo apt install --no-install-recommends gnome-keyring libpam-gnome-keyring
</code></pre><p>Also install <code>libsecret-tools</code> which allows access to the keyring using the <code>secret-tool</code> command.</p><pre><code class=language-shell-session>$ sudo apt install libsecret-tools
</code></pre><p>The installation adds an entry to <code>/etc/pam.d/common-password</code>, but you need to do some additional configuration if you want to start the keyring daemon when you log in on the console <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>. I removed the entry and edited the <code>/etc/pam.d/login</code> and <code>/etc/pam.d/passwd</code> files as described in the <a href=https://wiki.archlinux.org/index.php/GNOME/Keyring#PAM_method>Arch Linux Wiki</a> <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>.</p><h2 id=email>Email</h2><p>My email setup is heavily influenced by <a href=https://github.com/pbrisbin/dotfiles>Pat Brisbin&rsquo;s</a> <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>. It uses</p><ul><li>mbsync for syncing gmail over IMAP</li><li>msmtp for sending emails</li><li>mutt for reading mails</li></ul><p>Passwords for accounts can be added to the keyring using secret tool:</p><pre><code class=language-shell-session>$ secret-tool store --label=&quot;Gmail password for myaccount&quot; gmail myaccount
</code></pre><p>And looked up in <code>.mbsyncrc</code>:</p><pre><code class=language-plain>PassCmd &quot;secret-tool lookup gmail myaccount&quot;
</code></pre><p>and in <code>.msmtprc</code> <sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>:</p><pre><code class=language-plain>passwordeval secret-tool lookup gmail myaccount | awk 1
</code></pre><h3 id=mail-address-lookup>Mail Address Lookup</h3><p>When sending emails, programs will usually be able to lookup addresses either in a system address book or their own custom lists. With mutt, you need to decide how you want to maintain your contacts and tell it how to look them up. You can use a simple alias list, or <a href=https://wiki.archlinux.org/index.php/Mutt#Contact_management>set up an external query command</a>. I&rsquo;m using <code>abook</code>, which is a step up from simple aliases but still very basic. You can use it to query addresses and to add them directly from within mutt. I have the following added to my <code>.muttrc</code> file</p><pre><code class=language-plain>set query_command=&quot;abook --mutt-query '%s'&quot;

macro index,pager a &quot;| abook --add-email\n&quot;
</code></pre><p>The macro bound to &lsquo;a&rsquo; overrides the default <code>create-alias</code> command. You can bind it to something else if you want.</p><h2 id=xwindows-and-xmonad>XWindows and XMonad</h2><p>One of the reasons for switching systems was to be able to use <a href=http://xmonad.org>XMonad</a>. A tiling window manager just fits much better with a workflow which mostly involves using an editor and terminals. Indeed, it&rsquo;s hard to see the benefit of having to adjust window positions and sizes manually in any kind of workflow.</p><p>The required packages:</p><pre><code class=language-shell-session>$ sudo apt install xmonad dmenu xmobar xinit rxvt-unicode-256 x11-xserver-utils
</code></pre><p>Initial login still takes place on the console, which I prefer, but XMonad will be started when you run the <code>startx</code> command. You can customize the startup process by <a href=https://github.com/tekul/dotfiles/blob/master/xinitrc>writing your own <code>.xinitrc</code> file</a> <sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>.</p><p>I also installed the font packages <code>fonts-inconsolata</code> for use in the console and <code>fonts-wqy-zenhei</code> for Chinese support.</p><p>I didn&rsquo;t need to do much to <a href=https://github.com/tekul/dotfiles/blob/master/xmonad/xmonad.hs>customize XMonad</a>. I added some key mappings to make the volume control keys work, some shortcut keys, and set <code>urxvt</code> to be the terminal, but other than that it&rsquo;s a very standard setup <sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup>. <code>XMobar</code> provides a simple menu bar (which I can easily hide whenever I want) and <code>dmenu</code> makes it easy to run an application by typing its name (it is bound to the <code>Mod-p</code> key by default and provides text completion in the menu bar area).</p><h3 id=touchpad-sensitivity>Touchpad Sensitivity</h3><p>The sensitivity of the touchpad can cause problems because you can accidentally brush against it and change focus while you are tying, either to a different point in the same file or to another window altogether. Needless to say this is very annoying. There are tools such as <code>syndaemon</code> which disables the touchpad while you are typing and there are also settings to adjust the sensitivity, but I still found this to be an issue so I just disabled the touchpad by adding</p><pre><code class=language-plain>synclient TouchPadOff=1
</code></pre><p>to my <code>.xinitrc</code> file. I also have a key mapping defined to toggle it on and off if I really want to use it.</p><h2 id=sound>Sound</h2><p>I&rsquo;m still learning how the sound system works on Linux, but I installed the following packages</p><ul><li><code>alsa-utils</code> command line utils for setting the volume and so on. Useful for binding to keys in <code>xmonad.hs</code></li><li><code>sox</code> to be able to play and record from the command line (this duplicates some functionality in <code>alsa-utils</code> so may not be needed)</li></ul><h2 id=music>Music</h2><p>I&rsquo;ve always detested iTunes. It&rsquo;s always been a dreadful music player and the only thing I missed when I switched from Windows to OSX was the Winamp music player. For years iTunes didn&rsquo;t even have a simple &ldquo;add to queue&rdquo; feature and it only plays Apple approved file formats. These days its priorities are acting as a front end to the app store and as a file manager for your iPhone (which I don&rsquo;t have).</p><p>Unsurprisingly there are plenty of music players on Linux. My favourite was <a href=https://cmus.github.io/><code>cmus</code></a> which is a really nice terminal application with a very simple interface. The only customization I made was to set the colour scheme to &ldquo;zenburn&rdquo;. It&rsquo;s also available on OSX via homebrew, so iTunes is history. Good riddance.</p><h2 id=image-handling>Image Handling</h2><h3 id=viewing-and-editing>Viewing and Editing</h3><p><a href=https://feh.finalrewind.org/>feh</a> is a command line tool which displays images in a simple window. It&rsquo;s handy if you&rsquo;re working in the terminal and generating images or graphs which you want to view immediately.</p><p><a href=https://www.gimp.org/>Gimp</a> is an obvious choice if you want to edit images. It as an optional dependency on the package <code>tcpd</code> which seems unnecessary. I also installed the <code>imagemagick</code> package which has lots of useful command line tools.</p><pre><code class=language-shell-session>$ sudo apt install --no-install-recommends gimp
$ sudo apt install imagemagick
</code></pre><p>Gimp 2.8 comes with a single-window mode which works much better with XMonad tiling. This isn&rsquo;t the default, so you need to select it from the <code>Windows</code> menu or the tool windows will look weird.</p><h3 id=managing-photo-collections>Managing Photo Collections</h3><p>Loading and viewing photos is another requirement. My current choice is <code>gThumb</code> which seems to do everything I need and has fewer dependencies than the other major competitors I looked at.</p><pre><code class=language-shell-session>$ sudo apt install --no-install-recommends gthumb
</code></pre><p>I haven&rsquo;t been able to get it to download images from my phone yet, but I can do so using the command line tool <code>gphoto2</code>. For example, to download all files from a specific folder I use:</p><pre><code class=language-shell-session>$ gphoto2 -f /store_00010001/DCIM/Camera -P
</code></pre><h2 id=irc-and-instant-messaging>IRC and Instant Messaging</h2><p>A lot of messaging these days takes place on phones and I&rsquo;m fine with moving that way too, but there&rsquo;s a limit to how much I want to type on a phone. I still spend a lot of time in front of a computer and chat apps are pretty much essential if you collaborate with others remotely. I use Google chat with quite a few people so I needed a replacement for it. <a href=http://www.profanity.im>Profanity</a> is an XMPP client which seems to work well. It&rsquo;s another simple terminal application, based on the IRC client <a href=https://irssi.org>IRSSI</a>. IRSSI was also easy to get running with my existing freenode account.</p><p>I do still have a lot of contacts in Skype but I don&rsquo;t use it as often as I used to and I haven&rsquo;t checked out the Linux version yet.</p><h2 id=chinese-input-on-linux>Chinese Input on Linux</h2><p>I&rsquo;ve been learning (and re-learning) Chinese for a long time and the pinyin input method on OSX is very handy for people like me who can pronounce and recognise some characters, but not necessarily write them from memory.</p><p>The <a href=http://fcitx-im.org/><code>fcitx</code></a> package seems to be pretty much the standard and I found it easy enough to install and get working.</p><pre><code class=language-shell-session>$ sudo apt install fcitx fcitx-pinyin
</code></pre><p>You can add other input methods as desired, for example:</p><pre><code class=language-shell-session>$ sudo apt install fcitx-table-wubi fcitx-sunpinyin fcitx-googlepinyin
</code></pre><p>and choose which ones are enabled using <code>fcitx-configtool</code> or by editing the file <code>~/.config/fcitx/profile</code>.</p><p>This was enough to get pinyin input working in all applications I tried (and the terminal) apart from Emacs, for which there is a <a href=https://wiki.archlinux.org/index.php/Fcitx#Emacs>specific workaround</a>.</p><h3 id=adding-chinese-locale>Adding Chinese Locale</h3><p>Running <code>locale -a</code> showed that only English locales were available. To add simplified Chinese run:</p><pre><code class=language-shell-session>$ sudo locale-gen zh_CN.UTF-8
</code></pre><p>You can do this for any of the locales listed in <code>/usr/share/i18n/SUPPORTED</code>.</p><p>I have a shortcut in my <code>xmonad.hs</code> for running emacs. I changed this to set the variable beforehand:</p><pre><code class=language-plain>((mod4Mask, xK_s), spawn &quot;LC_CTYPE='zh_CN.UTF8' emacs24-x&quot;)
</code></pre><p>and <code>fcitx</code> then works in Emacs too (你看得见吗？). Emacs also has its own Chinese input method support but fcitx seems good enough for me.</p><h2 id=further-resources>Further Resources</h2><p>Most of the above was of course pilfered from other sources. Many of the programs I&rsquo;ve mentioned have excellent websites and documentation and I found the <a href=https://wiki.archlinux.org/>Arch Linux Wiki</a> really useful. Lots of people have also uploaded their configuration files to <a href=https://github.com/>github</a> and you can easily find relevant material there using github&rsquo;s source search. This is great both for tuning your own files and for finding out about other useful things that people are using <sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>.</p><h2 id=conclusions>Conclusions</h2><p>So far, I&rsquo;m pretty happy with my setup. There have been benefits I expected and also some things I like which I hadn&rsquo;t anticipated. I have a simple system with the bare minimum of installed packages to do what I want &ndash; there&rsquo;s none of the extra garbage that vendors feel the need to clutter their latest offerings with to attract attention. I had to learn various new commands to allow me to do things which would normally be done through a UI, but in the long term this is often more efficient. It&rsquo;s certainly no worse than having to remember the different &ldquo;control panel&rdquo; locations and sequences of menu items which a UI layers on top. Using the command line directly strips away this extra obfuscation and the knowledge is more portable than familiarity with different window-based utilities.</p><p>Working with XMonad is much nicer, particularly for programming, where a tiling window manager comes into its own. It&rsquo;s easy to fire up a terminal next to or below your current window without losing focus of what you were looking at before, whether it&rsquo;s a browser page or something in your editor. Working with multiple desktops and shunting windows between them quickly becomes a normal part of your workflow and there&rsquo;s no clutter taking up screen space unnecessarily. It&rsquo;s all super fast, without distractions such as animations, notification bars and so on. Since I haven&rsquo;t configured <code>mbsync</code> to pull down mail automatically, I also find that I now prefer to only read email when I choose, so there are no push notifications in the system at all and thus no interruptions when I&rsquo;m working on something.</p><p>I can&rsquo;t really come up with anything I need that is seriously missing on Linux. Some things, like hotplugging cameras and downloading images is slicker on OSX, but that&rsquo;s more an issue with my minimal setup than Linux in general &ndash; a standard distro installation would probably be better at this kind of thing. OSX has nicer fonts (Chinese sometimes mixes fonts and looks a bit rough in my terminal) but I&rsquo;m still hoping to make improvements on that front.</p><p>I hope someone finds something useful here. If anyone has any suggestions for things I might be missing, please let me know.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>There&rsquo;s nothing specific to the P50 in this article. It&rsquo;s quite a chunky, powerful machine. It has an Nvidia graphics card as well as the on-board Intel card and this is one area where Linux is a bit of a headache. Support for dual-graphics card laptops on Linux isn&rsquo;t great. The laptop screen runs fine using the Intel card, but there are some display issues if I use an external monitor with it. If I switch to the NVidia card exclusively it works fine but this requires a reboot and a BIOS switch. I haven&rsquo;t tried using NVidia&rsquo;s drivers or optimising the setup for switching between the cards yet. There are tools for this but it seems like a bit of a minefield and I&rsquo;m happy enough with it for now. This will improve in future versions, but if you don&rsquo;t need high-performance graphics then you might be better picking a machine with a single card.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>My initial motivation for the switch to Arch Linux was to have a system with a newer kernel and <code>xorg</code> packages (1.19+) which had better support for Nvidia hardware and dual graphics cards. Any concerns I might have had about stability didn&rsquo;t last long. I&rsquo;ve had very few issues and the documentation is great.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>There is a timeout configured somewhere which I changed the first time I ran into the problem, but I can&rsquo;t find the file anymore. In any case it doesn&rsquo;t matter once the ethernet settings have been removed from <code>/etc/network/interfaces</code>.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>NetworkManager can be integrated with gnome keyring, using a <a href=https://developer.gnome.org/NetworkManager/stable/gdbus-org.freedesktop.NetworkManager.SecretAgent.html><code>SecretAgent</code></a> service. Removing the <code>psk</code> and setting <code>psk-flags=1</code> in the connection file means a user secret agent will be asked for the password (see <code>man nm-settings</code>). The <code>nm-applet</code> application from the package <code>network-manager-gnome</code> implements the required service interface. It will ask the user for the password on demand and store it for late use in the keyring. If you don&rsquo;t install this, a workaround is to remove the <code>psk</code> entry from the connection file and get <code>nmcli</code> to ask you to enter the password: <code>nmcli --ask connection up Cafe</code>. I also had a go at <a href=https://github.com/tekul/nm-agent>writing my own SecretAgent</a> to try out the Haskell <code>dbus</code> and <code>gnome-keyring</code> libraries.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>There is a tool called <code>pam-auth-update</code> which adds (or removes) the gnome keyring entry automatically. I guess it only adds the password entry since I&rsquo;m using the console rather than a standard gnome setup.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>Setting the PAM stuff up seems quite temperamental and I had some problems. For example, the keyring daemon would be started but the keyring wouldn&rsquo;t be unlocked on login and I would still be prompted for my password when it was needed. So far, I can also only get <code>secret-tool</code> to work from within X-Windows.&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>Note that the mutt/email articles in his blog are out of date compared to the current setup.&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><code>msmtp</code> is supposed to integrate directly with the keyring but I couldn&rsquo;t get it to work. In any case it makes more sense to share the same keyring entry between the two. The <code>passwordeval</code> option enables this. It fails without the <code>awk 1</code>, probably because it doesn&rsquo;t write out the required newline.&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p>The default setup sources the files in <code>/etc/X11/Xsession.d</code> and ends up by running the script <code>/usr/bin/x-session-manager</code> which starts xmonad. For more information on the startup sequence, see the <code>startx</code> man page.&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p>Details of fonts and other customizations for urxvt can be found in the <a href=https://github.com/tekul/dotfiles/blob/master/Xdefaults>.Xdefaults file</a>.&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p>This is how I found out about <code>cmus</code>, for example. I think it was <a href=https://github.com/ssh0/dotfiles>in this repo</a> which also has quite a sophisticated Xmonad setup.&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article></main></div></body></html>