<!doctype html><html lang=en><head><title>Checking Password Strength in Elm, Part 1: Zxcvbn</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Using the Zxcvbn Javascript library in an Elm application."><link href="/css/main.min.cbea4dffd5bf7bf2c87de9504c4cac811c1f22ad854c538f0e08bbad25d60973.css" rel=stylesheet><link rel=icon type=image/svg+xml href=/images/logo.svg><link rel=stylesheet href=https://rsms.me/inter/inter.css><script src=/js/prism.js></script></head><body class="bg-stone-50 text-stone-600 dark:bg-stone-900 dark:text-stone-400"><nav class="mb-1 shadow dark:shadow-none dark:border-b dark:border-stone-300/10"><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"><div class="relative flex justify-between h-20"><div class="absolute inset-y-0 left-0 flex items-center sm:hidden"><button id=menu-button type=button class="inline-flex items-center justify-center p-2 rounded-md text-stone-400 hover:text-stone-500 hover:bg-stone-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-600" aria-controls=mobile-menu aria-expanded=false>
<span class=sr-only>Open main menu</span><svg id="open-menu-icon" class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg><svg id="close-menu-icon" class="hidden h-6 w-6" xmlns="htp://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start"><div class="flex-shrink-0 flex items-center"><a href=/><svg class="block lg:hidden h-14 w-auto dark:fill-stone-300 dark:stroke-stone-400" viewBox="0 0 1250 1250"><desc>Broch logo</desc><path d="M50 550A5e2 5e2.0 01550 50h145a5e2 5e2.0 015e2 5e2v1e2a5e2 5e2.0 01-5e2 5e2v-130a370 370 0 00370-370m0-1e2A370 370 0 00695 180H550A370 370 0 00180 550m0 1e2a370 370 0 00370 370v130A5e2 5e2.0 0150 650V550" stroke-width="55" fill="none"/></svg><svg class="hidden lg:block h-14 w-auto dark:fill-stone-300 dark:stroke-stone-400" stroke="#292524" fill="#292524" viewBox="0 0 3500 1250"><desc>Broch logo</desc><g><path d="M50 550A5e2 5e2.0 01550 50h145a5e2 5e2.0 015e2 5e2v1e2a5e2 5e2.0 01-5e2 5e2v-130a370 370 0 00370-370m0-1e2A370 370 0 00695 180H550A370 370 0 00180 550m0 1e2a370 370 0 00370 370v130A5e2 5e2.0 0150 650V550" stroke-width="55" fill="none"/></g><g transform="translate(1600 1050) scale(.18 -.18)"><path d="m525 3939c-137-15-256-28-263-28-10-1-12-289-10-1423l3-1423 267-3 267-2 5 32c3 18 10 60 16 92 5 33 10 62 10 64 0 3 33-26 73-64 85-82 137-114 243-151 71-24 93-27 214-27 98-1 153 4 2e2 17 258 69 463 295 555 613 40 137 55 260 55 456 0 417-89 7e2-279 888-128 127-269 181-471 182-201 0-342-54-472-183l-78-76v533 534l-42-1c-24-1-155-14-293-30zm811-1247c56-29 119-103 144-169 34-92 51-230 51-427 0-99-5-213-11-251-31-198-95-316-204-373-44-22-63-26-136-26-122 0-203 40-281 137l-39 50v427 428l43 59c63 84 130 136 217 164 46 15 171 4 216-19z"/><path d="m8303 3942-253-25V2493 1070h3e2 3e2v698 697l51 67c96 128 197 192 303 192 70-1 115-20 144-61 47-69 46-54 50-845l3-748h299 3e2v803c0 891 0 881-66 1016-108 219-359 323-642 265-141-29-251-87-366-195l-76-71v541 541l-47-1c-27-1-162-13-3e2-27z"/><path d="m4655 3155c-268-42-482-178-629-399-234-353-231-1006 7-1356 123-181 310-311 521-360 182-44 421-44 591 0 1e2 25 241 93 322 154 302 228 436 668 356 1166-60 379-286 657-618 759-155 48-380 63-550 36zm306-445c82-23 161-105 2e2-209 65-175 77-537 23-744-35-138-99-228-192-274-50-24-68-28-147-28-105 0-163 23-226 88-99 102-148 320-136 612 7 171 27 277 72 372 78 167 225 234 406 183z"/><path d="m6898 3155c-402-68-686-357-779-795-29-136-32-406-6-547 87-473 408-765 884-803 134-10 285 3 399 35 156 44 393 176 380 211-4 10-223 326-250 361-1 1-51-22-111-52-79-39-135-59-198-71-81-16-93-16-169-1-236 46-330 240-315 642 9 231 49 363 140 462 136 147 391 144 613-7l40-28 128 175c72 1e2 125 182 122 190-9 23-187 132-269 164-195 75-410 97-609 64z"/><path d="m3498 3137c-153-53-279-181-354-364-13-32-24-53-24-48-1 6-11 91-23 190l-22 180-267 3-268 2V2085 1070h305 304l3 533 3 532 33 95c98 283 233 378 480 337 60-10 85-11 88-3 7 20 94 569 91 573-10 10-121 23-196 23-63 0-104-7-153-23z"/></g></svg></a></div><div class="hidden sm:ml-9 sm:flex sm:space-x-8"><a class="border-transparent text-stone-400 hover:border-stone-300 hover:text-stone-700 dark:hover:text-stone-400 inline-flex items-center px-1 pt-1 border-b-2 text-lg font-medium" href=/ title>Home</a>
<a class="border-red-600 dark:border-red-500 text-stone-900 dark:text-stone-300 inline-flex items-center px-1 pt-1 border-b-2 text-lg font-medium" href=/posts/ title=Blog>Blog</a></div></div><div class="absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0"><a href=/index.xml class="p-1 rounded-full text-stone-400 hover:text-stone-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><span class=sr-only>RSS Feed</span><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18.0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"/></svg></a></dev></div></div><div class=hidden id=mobile-menu><div class="pt-2 pb-4 space-y-1"><a class="border-transparent text-stone-500 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-400 hover:border-stone-300 hover:text-stone-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium" href=/ title>Home</a>
<a class="bg-red-50 dark:bg-red-800 border-red-600 text-red-900 dark:text-red-300 block pl-3 pr-4 py-2 border-l-4 text-base font-medium" href=/posts/ title=Blog>Blog</a></div></div></nav><script>var menu_open=!1,menu_button=document.getElementById("menu-button"),menu=document.getElementById("mobile-menu"),open_icon=document.getElementById("open-menu-icon"),close_icon=document.getElementById("close-menu-icon");menu_button.addEventListener("click",function(){menu_open=!menu_open,menu_open?(menu.className="block sm:hidden",close_icon.className.baseVal="block h-6 w-6",open_icon.className.baseVal="hidden h-6 w-6"):(menu.className="hidden",open_icon.className.baseVal="block h-6 w-6",close_icon.className.baseVal="hidden h-6 w-6")})</script><div class="w-full max-w-7xl mx-auto"><main><article class="py-12 px-4 sm:px-8 lg:px-8 prose prose-stone prose-lg max-w-none lg:prose-xl dark:prose-invert"><h1>Checking Password Strength in Elm, Part 1: Zxcvbn</h1><p class="block flex display-between text-stone-500 dark:text-stone-400 italic">March 4, 2018
<span class=ml-3>(Updated, February 25, 2021)</span></p><p>As part of a recent Elm project, I wrote some front-end user registration code which required that new users choose a password. I used the <a href=https://github.com/dropbox/zxcvbn>zxcvbn</a> library to measure password strength and this seems like a good, non-trivial example to show how to call Javascript from Elm. In <a href=/posts/elm-have-i-been-pwned>Part 2</a>, we&rsquo;ll look at how to add extra checks by calling the <a href=https://haveibeenpwned.com/API/v3#PwnedPasswords>Have I Been Pwned passwords API</a> which maintains a database of half a billion compromised password hashes.</p><p>The full code for both parts can be found <a href=https://github.com/tekul/elm-password-check>on github</a>.</p><p>Zxcvbn is a password strength estimator which makes use of password frequency lists, dictionaries and common patterns. Note that the default version is heavily biased towards English language so it would need to be built with custom dictionaries if that&rsquo;s an issue <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><p>The strength of a password is based on estimating the number of guesses it would take for a password cracker to find it. It&rsquo;s not perfect, but is better than forcing annoying rules on users such as adding <a href=https://www.xkcd.com/936/>numbers and symbols to passwords</a> which is no longer seen as good practice. Standards authorities like NIST now <a href=https://stealthbits.com/blog/nist-password-guidelines/>recommend</a> disallowing simple sequences and rejecting passwords which are found in password breach databases.</p><div id=elm-zxcvbn-app class="w-full mt-10 px-10 py-10 border rounded-md shadow-lg bg-neutral-200 text-neutral-700 dark:shadow-none mx-auto sm:w-2/3"><div id=app></div></div><script src=app.js></script><script>var app=Elm.Main.init({node:document.getElementById("app"),flags:{}});app.ports.checkPassword.subscribe(function(e){var t=zxcvbn(e);app.ports.passwordChecked.send(t)})</script><script async src=/js/zxcvbn.js></script><h2 id=elm-ports>Elm Ports</h2><p>From Elm, we want to be able to call a <code>checkPassword</code> function, passing the password as a string. This function is a &ldquo;port&rdquo;, so the Elm runtime knows to call an external Javascript function as the implementation.</p><pre><code class=language-elm>port checkPassword : String -&gt; Cmd msg

port passwordChecked : (Json.Value -&gt; msg) -&gt; Sub msg
</code></pre><p>Zxcvbn produces a JSON value containing a score for the password and information about how the score was calculated. The second port, <code>passwordChecked</code> allows us to subscribe to the Zxcvbn response. The responses will then be received as messages through the application <code>update</code> function.</p><h2 id=javascript>Javascript</h2><p>In Javascript we need to hook up our port implementations to Javascript code. The <code>checkPassword</code> function is just implemented as a call to the <code>zxcvbn</code> function, passing in the password. It then sends the response back through the <code>passwordChecked</code> port.</p><pre><code class=language-javascript>app.ports.checkPassword.subscribe(function(password) {
    var report = zxcvbn(password);
    app.ports.passwordChecked.send(report);
});
</code></pre><h2 id=decoding-json>Decoding JSON</h2><p>When we receive the Zxcvbn report as a JSON value, we decode it into a matching Elm data structure to make sure it contains what we expect and to make it easier to work with:</p><pre><code class=language-elm>type alias Zxcvbn =
    { password : String
    , guesses : Float
    , guessesLog10 : Float
    , calcTime : Int
    , crackTimesSeconds : CrackTimesSeconds
    , crackTimesDisplay : CrackTimesDisplay
    , score : Int
    , feedback : Feedback
    , matchSequence : List String
    }
</code></pre><p>Writing decoders in Elm is straightforward enough but requires quite a lot of boilerplate code. You can check the github repo for details. The call to Zxcvbn returns a lot of data, most of which isn&rsquo;t needed for a real-world application. Even though the <code>Zxcvbn</code> Elm record type above retains most of that data it could be a lot simpler <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. For a real application, we would probably only need the <code>score</code> and <code>feedback</code> fields to provide the strength meter and information on why particular passwords are unsuitable. The decoder would then also be a lot simpler. For a demo like this though, it&rsquo;s interesting to show how a password is matched by the library.</p><h2 id=the-main-module>The Main module</h2><p>The rest of the code is a standard Elm application. We have a simple model to contain the entered password and the decoded Zxcvbn report</p><pre><code class=language-elm>type alias Model =
    { password : String
    , zxcvbn : Maybe Zxcvbn
    }
</code></pre><p>In our <code>update</code> function we need to handle messages for both password input and password check responses</p><pre><code class=language-elm>type Msg
    = SetPassword String
    | PasswordChecked Json.Value
</code></pre><p>The first message constructor is handled by just setting the password value in the model. For the second we call the Zxcvbn decoder and set the <code>zxcvbn</code> field in the model. The <code>view</code> function just renders an HTML input field for the password and shows the strength information for the entered value.</p><p>It&rsquo;s important that we remember to include the <code>passwordChecked</code> port in our <code>subscriptions</code> function so that we receive responses from the Javascript code. These will arrive wrapped in a <code>PasswordChecked</code> message</p><pre><code class=language-elm>subscriptions : Model -&gt; Sub Msg
subscriptions _ =
    passwordChecked PasswordChecked
</code></pre><h2 id=conclusion>Conclusion</h2><p>It&rsquo;s quite easy to make use of a Javascript library like Zxcvbn, getting it to do a lot of work for us, but without compromising the safety of our Elm code. Ports provide a boundary which forces us to decode the data we get from Javascript into type-safe values before using them.</p><p>In the second part, we&rsquo;ll look at calling an external API to get extra information on the suitability of our chosen password.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>For example, it will flag up &ldquo;iloveyou&rdquo; as being one of the most common passwords but it doesn&rsquo;t have a problem with &ldquo;ichliebedich&rdquo;. Have I Been Pwned? doesn&rsquo;t suffer from this issue and will tell you that the latter has been found more than 16000 times in password data breaches, so is clearly unsuitable.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>The <code>matchSequence</code> field is simplified to just include a list of matched tokens and the pattern type (dictionary, date, keyboard sequence etc.) rather than the full details for each sub-match.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article></main></div></body></html>